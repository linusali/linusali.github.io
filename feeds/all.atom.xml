<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Bootsha</title><link href="https://bootsha.net/" rel="alternate"></link><link href="https://bootsha.net/feeds/all.atom.xml" rel="self"></link><id>https://bootsha.net/</id><updated>2018-01-19T21:31:00+04:00</updated><entry><title>A simple bash script bot to send status message to telegram.</title><link href="https://bootsha.net/a-simple-bash-script-bot-to-send-status-message-to-telegram.html" rel="alternate"></link><published>2018-01-19T21:31:00+04:00</published><updated>2018-01-19T21:31:00+04:00</updated><author><name>MS</name></author><id>tag:bootsha.net,2018-01-19:/a-simple-bash-script-bot-to-send-status-message-to-telegram.html</id><summary type="html">&lt;h2&gt;The telegram bot script&lt;/h2&gt;
&lt;p&gt;Here is a simple telegram bot script I have used to send out OpenStack deployment status message to my telegram. 
    :::bash
    #!/bin/bash&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;token=&amp;quot;bot[telegram-bot-api-token]&amp;quot;
chat_id= # Send a chat to bot from telegram and hit https://api.telegram.org/bot[telegram-bot-api-token]/getUpdates to see chat_id …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h2&gt;The telegram bot script&lt;/h2&gt;
&lt;p&gt;Here is a simple telegram bot script I have used to send out OpenStack deployment status message to my telegram. 
    :::bash
    #!/bin/bash&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;token=&amp;quot;bot[telegram-bot-api-token]&amp;quot;
chat_id= # Send a chat to bot from telegram and hit https://api.telegram.org/bot[telegram-bot-api-token]/getUpdates to see chat_id

if [ -f ~/.bot-stat]; then
    source ~/.bot-stat
else
  lstatus=&amp;quot;OK&amp;quot;
  sdate=$(date +%s)
fi

send_message(){
    tmpfile=$(mktemp /tmp/telebot.XXXXXXX)
    mstatus=$(echo &lt;span class="nv"&gt;$status&lt;/span&gt;|sed -e &amp;#39;s/_/ /g&amp;#39;)
    cat &amp;gt; &lt;span class="nv"&gt;$tmpfile&lt;/span&gt; &lt;span class="err"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;EOF&lt;/span&gt;
&lt;span class="err"&gt;{&amp;quot;chat_id&amp;quot;:&amp;quot;$chat_id&amp;quot;,&lt;/span&gt; &lt;span class="err"&gt;&amp;quot;parse_mode&amp;quot;:&amp;quot;markdown&amp;quot;,&lt;/span&gt; &lt;span class="err"&gt;&amp;quot;text&amp;quot;:&amp;quot;*Deployment*\nStatus:&lt;/span&gt; &lt;span class="err"&gt;*$mstatus*\nTime:&lt;/span&gt; &lt;span class="err"&gt;$date&lt;/span&gt; &lt;span class="err"&gt;\nDuration:&lt;/span&gt; &lt;span class="err"&gt;$duration&amp;quot;}&lt;/span&gt;
&lt;span class="err"&gt;EOF&lt;/span&gt;
    &lt;span class="err"&gt;curl&lt;/span&gt; &lt;span class="err"&gt;-k&lt;/span&gt; &lt;span class="err"&gt;--header&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;Content-Type:&lt;/span&gt; &lt;span class="err"&gt;application/json&amp;#39;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;
        &lt;span class="err"&gt;--data-binary&lt;/span&gt; &lt;span class="err"&gt;@${tmpfile}&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;
        &lt;span class="err"&gt;--request&lt;/span&gt; &lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;https://api.telegram.org/$token/sendMessage&lt;/span&gt;
    &lt;span class="err"&gt;rm&lt;/span&gt; &lt;span class="err"&gt;-f&lt;/span&gt; &lt;span class="err"&gt;$tmpfile&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;

&lt;span class="err"&gt;while&lt;/span&gt; &lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="err"&gt;;&lt;/span&gt; &lt;span class="err"&gt;do&lt;/span&gt;
    &lt;span class="na"&gt;status=&lt;/span&gt;&lt;span class="s"&gt;$(source&lt;/span&gt; &lt;span class="err"&gt;~/stackrc&lt;/span&gt; &lt;span class="err"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="err"&gt;openstack&lt;/span&gt; &lt;span class="err"&gt;stack&lt;/span&gt; &lt;span class="err"&gt;list&lt;/span&gt; &lt;span class="err"&gt;-c&lt;/span&gt; &lt;span class="err"&gt;&amp;quot;Stack&lt;/span&gt; &lt;span class="err"&gt;Status&amp;quot;&lt;/span&gt; &lt;span class="err"&gt;-f&lt;/span&gt; &lt;span class="err"&gt;value)&lt;/span&gt;
    &lt;span class="err"&gt;if&lt;/span&gt; &lt;span class="err"&gt;[&lt;/span&gt; &lt;span class="err"&gt;&amp;quot;$status&amp;quot;&lt;/span&gt; &lt;span class="err"&gt;!=&lt;/span&gt; &lt;span class="err"&gt;&amp;quot;$lstatus&amp;quot;&lt;/span&gt; &lt;span class="err"&gt;];&lt;/span&gt; &lt;span class="err"&gt;then&lt;/span&gt;
       &lt;span class="na"&gt;cdate=&lt;/span&gt;&lt;span class="s"&gt;$(date&lt;/span&gt; &lt;span class="err"&gt;+%s)&lt;/span&gt;
       &lt;span class="na"&gt;date=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="s"&gt;(date +%D-%H:%M:%S)&amp;quot;&lt;/span&gt;
       &lt;span class="na"&gt;duration=&lt;/span&gt;&lt;span class="s"&gt;$(($cdate-$sdate))&lt;/span&gt;
       &lt;span class="err"&gt;send_message&lt;/span&gt;
       &lt;span class="na"&gt;lstatus=&lt;/span&gt;&lt;span class="s"&gt;$status&lt;/span&gt;
       &lt;span class="na"&gt;sdate=&lt;/span&gt;&lt;span class="s"&gt;$cdate&lt;/span&gt;
       &lt;span class="err"&gt;echo&lt;/span&gt; &lt;span class="err"&gt;-e&lt;/span&gt; &lt;span class="err"&gt;&amp;quot;&lt;/span&gt;&lt;span class="na"&gt;lstatus=&lt;/span&gt;&lt;span class="s"&gt;$status\nsdate=$cdate&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;&amp;gt;&lt;/span&gt; ~/.bot-stat
    fi
    sleep 5
done
&lt;/pre&gt;&lt;/div&gt;</content></entry><entry><title>egrep Regex for filtering mac</title><link href="https://bootsha.net/egrep-regex-for-filtering-mac.html" rel="alternate"></link><published>2018-01-18T21:31:00+04:00</published><updated>2018-01-18T21:31:00+04:00</updated><author><name>MS</name></author><id>tag:bootsha.net,2018-01-18:/egrep-regex-for-filtering-mac.html</id><summary type="html">&lt;h2&gt;egrep Regex&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;([0-9a-f]{2}:){5}[0-9a-f]{2}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Example&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; i in &lt;span class="k"&gt;$(&lt;/span&gt;virsh list &lt;span class="p"&gt;|&lt;/span&gt;grep -v Name&lt;span class="p"&gt;|&lt;/span&gt;awk &lt;span class="s1"&gt;&amp;#39;{print $2}&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; 
   &lt;span class="nb"&gt;echo&lt;/span&gt; -e &lt;span class="nv"&gt;$i&lt;/span&gt; 
   virsh domiflist &lt;span class="nv"&gt;$i&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; egrep &lt;span class="s1"&gt;&amp;#39;([0-9a-f]{2}:){5}[0-9a-f]{2}&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $NF}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h2&gt;egrep Regex&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;([0-9a-f]{2}:){5}[0-9a-f]{2}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Example&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; i in &lt;span class="k"&gt;$(&lt;/span&gt;virsh list &lt;span class="p"&gt;|&lt;/span&gt;grep -v Name&lt;span class="p"&gt;|&lt;/span&gt;awk &lt;span class="s1"&gt;&amp;#39;{print $2}&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; 
   &lt;span class="nb"&gt;echo&lt;/span&gt; -e &lt;span class="nv"&gt;$i&lt;/span&gt; 
   virsh domiflist &lt;span class="nv"&gt;$i&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; egrep &lt;span class="s1"&gt;&amp;#39;([0-9a-f]{2}:){5}[0-9a-f]{2}&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $NF}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content></entry><entry><title>Usefull utility to Control bandwidth</title><link href="https://bootsha.net/usefull-utility-to-control-bandwidth.html" rel="alternate"></link><published>2018-01-18T00:00:00+04:00</published><updated>2018-01-18T00:00:00+04:00</updated><author><name>MS</name></author><id>tag:bootsha.net,2018-01-18:/usefull-utility-to-control-bandwidth.html</id><summary type="html">&lt;h2&gt;Useful utility to control bandwidth.&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;tc&lt;/code&gt; is a useful utility to control bandwidth and to simulate long distance links 
Here is the man page &lt;a href="https://linux.die.net/man/8/tc"&gt;https://linux.die.net/man/8/tc&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Example&lt;/h2&gt;
&lt;p&gt;Thanks to Taco (my collegue) for the tip&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;tc qdisc add dev eth0 root netem delay 100ms
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;For …&lt;/p&gt;</summary><content type="html">&lt;h2&gt;Useful utility to control bandwidth.&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;tc&lt;/code&gt; is a useful utility to control bandwidth and to simulate long distance links 
Here is the man page &lt;a href="https://linux.die.net/man/8/tc"&gt;https://linux.die.net/man/8/tc&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Example&lt;/h2&gt;
&lt;p&gt;Thanks to Taco (my collegue) for the tip&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;tc qdisc add dev eth0 root netem delay 100ms
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;For a 100ms delay for every packet traversing eth0. You may use a Linux 'gateway' node to simulate two DC.&lt;/p&gt;</content></entry><entry><title>Recover from Pacemaker resource management disabled .</title><link href="https://bootsha.net/recover-from-pacemaker-resource-management-disabled.html" rel="alternate"></link><published>2018-01-17T17:13:00+04:00</published><updated>2018-01-17T17:13:00+04:00</updated><author><name>MS</name></author><id>tag:bootsha.net,2018-01-17:/recover-from-pacemaker-resource-management-disabled.html</id><summary type="html">&lt;h2&gt;The error message&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;         *** Resource management is DISABLED ***
The cluster will not attempt to start, stop or recover services
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Get cluster out of maintenance mode&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pcs property &lt;span class="nb"&gt;unset&lt;/span&gt; maintenance-mode
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;To start the pacemaker cluster&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pcs cluster start --all
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Referrence and Thanks&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://www.cloudatoz.com/openstack-resource-management-is-disabled/"&gt;https://www.cloudatoz.com/openstack-resource-management-is-disabled/&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;h2&gt;The error message&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;         *** Resource management is DISABLED ***
The cluster will not attempt to start, stop or recover services
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Get cluster out of maintenance mode&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pcs property &lt;span class="nb"&gt;unset&lt;/span&gt; maintenance-mode
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;To start the pacemaker cluster&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pcs cluster start --all
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Referrence and Thanks&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://www.cloudatoz.com/openstack-resource-management-is-disabled/"&gt;https://www.cloudatoz.com/openstack-resource-management-is-disabled/&lt;/a&gt;&lt;/p&gt;</content></entry><entry><title>How to download images from OpenStack Glance.</title><link href="https://bootsha.net/how-to-download-images-from-openstack-glance.html" rel="alternate"></link><published>2018-01-16T15:33:00+04:00</published><updated>2018-01-16T15:33:00+04:00</updated><author><name>MS</name></author><id>tag:bootsha.net,2018-01-16:/how-to-download-images-from-openstack-glance.html</id><summary type="html">&lt;h2&gt;Here is the syntax to download images from OpenStack glance&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;source&lt;/span&gt; overcloudrc
openstack image save --file local-file-name.qcow2 image-name
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Or if you would like to compress the downloaded image on the fly&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;source&lt;/span&gt; overcloudrc
openstack image save image-name &lt;span class="p"&gt;|&lt;/span&gt; gzip -c &amp;gt; local-file-name.raw.gz
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Example&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;stack@ospdir ~&lt;span class="o"&gt;]&lt;/span&gt;$ &lt;span class="nb"&gt;source&lt;/span&gt; overcloudrc
&lt;span class="o"&gt;(&lt;/span&gt;admin@overcloud …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h2&gt;Here is the syntax to download images from OpenStack glance&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;source&lt;/span&gt; overcloudrc
openstack image save --file local-file-name.qcow2 image-name
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Or if you would like to compress the downloaded image on the fly&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;source&lt;/span&gt; overcloudrc
openstack image save image-name &lt;span class="p"&gt;|&lt;/span&gt; gzip -c &amp;gt; local-file-name.raw.gz
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Example&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;stack@ospdir ~&lt;span class="o"&gt;]&lt;/span&gt;$ &lt;span class="nb"&gt;source&lt;/span&gt; overcloudrc
&lt;span class="o"&gt;(&lt;/span&gt;admin@overcloud&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;stack@ospdir ~&lt;span class="o"&gt;]&lt;/span&gt;$ openstack image list -c ID -c Name -c &lt;span class="s2"&gt;&amp;quot;Disk Format&amp;quot;&lt;/span&gt; -c Size -f table --long
+--------------------------------------+----------+-------------+-------------+
&lt;span class="p"&gt;|&lt;/span&gt; ID                                   &lt;span class="p"&gt;|&lt;/span&gt; Name     &lt;span class="p"&gt;|&lt;/span&gt; Disk Format &lt;span class="p"&gt;|&lt;/span&gt;        Size &lt;span class="p"&gt;|&lt;/span&gt;
+--------------------------------------+----------+-------------+-------------+
&lt;span class="p"&gt;|&lt;/span&gt; 6c5384f6-cf86-4a41-b9d4-8cafbb9c08fc &lt;span class="p"&gt;|&lt;/span&gt; CentOS74 &lt;span class="p"&gt;|&lt;/span&gt; qcow2       &lt;span class="p"&gt;|&lt;/span&gt;   &lt;span class="m"&gt;854851584&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; 4d43fb6d-16a3-4c85-8eab-f0088a9f5aaa &lt;span class="p"&gt;|&lt;/span&gt; Win2k16  &lt;span class="p"&gt;|&lt;/span&gt; raw         &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;42954915840&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; 3bcdeb04-9170-4f2c-8468-8797477b6c02 &lt;span class="p"&gt;|&lt;/span&gt; cirros   &lt;span class="p"&gt;|&lt;/span&gt; qcow2       &lt;span class="p"&gt;|&lt;/span&gt;    &lt;span class="m"&gt;13267968&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;
+--------------------------------------+----------+-------------+-------------+
&lt;span class="o"&gt;(&lt;/span&gt;admin@overcloud&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;stack@ospdir ~&lt;span class="o"&gt;]&lt;/span&gt;$ openstack image save Win2K16 &lt;span class="p"&gt;|&lt;/span&gt; gzip -c &amp;gt; Win2K16.raw.gz
&lt;span class="o"&gt;(&lt;/span&gt;admin@overcloud&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;stack@ospdir ~&lt;span class="o"&gt;]&lt;/span&gt;$ du -b Win2k16.raw.gz
&lt;span class="m"&gt;9151990788&lt;/span&gt;    Win2k16.raw.gz
&lt;span class="o"&gt;(&lt;/span&gt;admin@overcloud&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;stack@ospdir ~&lt;span class="o"&gt;]&lt;/span&gt;$ openstack image save --file  cirros.qcow2 cirros
&lt;span class="o"&gt;(&lt;/span&gt;admin@overcloud&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;stack@ospdir ~&lt;span class="o"&gt;]&lt;/span&gt;$ du -b cirros.qcow2
&lt;span class="m"&gt;13267968&lt;/span&gt;    Win2k16.raw.gz
&lt;/pre&gt;&lt;/div&gt;</content></entry></feed>